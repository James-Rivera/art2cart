<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Functionality Test - Art2Cart</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .btn {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #005a87; }
        .product-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cart-count {
            background: #dc3545;
            color: white;
            border-radius: 50%;
            padding: 2px 8px;
            font-size: 12px;
            margin-left: 10px;
        }
        .test-results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ðŸ›’ Art2Cart - Shopping Cart Test Page</h1>
    
    <div class="test-section">
        <h2>System Status</h2>
        <div id="system-status">
            <div class="info">Loading system status...</div>
        </div>
    </div>

    <div class="test-section">
        <h2>Authentication Status</h2>
        <div id="auth-status">
            <div class="info">Checking authentication...</div>
        </div>
        <button class="btn" onclick="window.location.href='auth/auth.html'">Login/Register</button>
        <button class="btn" onclick="window.location.href='auth/logout.php'">Logout</button>
    </div>

    <div class="test-section">
        <h2>Cart Header Badge Test</h2>
        <div style="background: #333; color: white; padding: 10px; border-radius: 4px;">
            Cart Items: <span id="header-cart-count" class="cart-count">0</span>
            <button class="btn" onclick="updateCartDisplay()">Refresh Count</button>
        </div>
    </div>

    <div class="test-section">
        <h2>Product Catalogue Test</h2>
        <div id="products-list">
            <div class="info">Loading products...</div>
        </div>
    </div>

    <div class="test-section">
        <h2>Cart Management</h2>
        <button class="btn" onclick="viewCart()">View Cart</button>
        <button class="btn" onclick="clearCart()">Clear Cart</button>
        <div id="cart-contents" class="test-results"></div>
    </div>

    <div class="test-section">
        <h2>Test Results</h2>
        <div id="test-log" class="test-results">
            <p>Ready to run tests...</p>
        </div>
    </div>

    <script>
        let testLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            testLog.push(`[${timestamp}] ${message}`);
            updateTestLog();
            
            // Also show in console
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function updateTestLog() {
            document.getElementById('test-log').innerHTML = 
                testLog.slice(-10).map(msg => `<div>${msg}</div>`).join('');
        }

        // Check system status
        async function checkSystemStatus() {
            try {
                const response = await fetch('cart_status.php');
                const data = await response.text();
                document.getElementById('system-status').innerHTML = 
                    '<div class="success">âœ“ System operational</div>';
                log('System status check passed', 'success');
            } catch (error) {
                document.getElementById('system-status').innerHTML = 
                    '<div class="error">âœ— System error: ' + error.message + '</div>';
                log('System status check failed: ' + error.message, 'error');
            }
        }

        // Check authentication status
        async function checkAuthStatus() {
            try {
                const response = await fetch('api/cart.php?action=get');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('auth-status').innerHTML = 
                        '<div class="success">âœ“ User authenticated</div>';
                    log('User is authenticated', 'success');
                    updateCartDisplay();
                } else {
                    document.getElementById('auth-status').innerHTML = 
                        '<div class="error">âœ— User not authenticated</div>';
                    log('User not authenticated', 'info');
                }
            } catch (error) {
                document.getElementById('auth-status').innerHTML = 
                    '<div class="error">âœ— Auth check failed: ' + error.message + '</div>';
                log('Auth check failed: ' + error.message, 'error');
            }
        }

        // Load sample products for testing
        async function loadProducts() {
            try {
                const response = await fetch('simple_test.php');
                
                // For demo purposes, create some test products
                const products = [
                    {id: 1, title: 'Abstract Art Piece', price: 299.99},
                    {id: 2, title: 'Modern Sculpture', price: 499.99},
                    {id: 3, title: 'Digital Canvas', price: 199.99}
                ];

                let productsHTML = '';
                products.forEach(product => {
                    productsHTML += `
                        <div class="product-card">
                            <div>
                                <strong>${product.title}</strong><br>
                                <span>$${product.price}</span>
                            </div>
                            <button class="btn" onclick="addToCart(${product.id}, '${product.title}')">
                                Add to Cart
                            </button>
                        </div>
                    `;
                });

                document.getElementById('products-list').innerHTML = productsHTML;
                log('Sample products loaded', 'success');
            } catch (error) {
                document.getElementById('products-list').innerHTML = 
                    '<div class="error">Error loading products: ' + error.message + '</div>';
                log('Failed to load products: ' + error.message, 'error');
            }
        }

        // Add to cart function
        async function addToCart(productId, productTitle) {
            try {
                const response = await fetch('api/cart.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: `action=add&product_id=${productId}&quantity=1`
                });

                const data = await response.json();
                
                if (data.success) {
                    log(`âœ“ Added "${productTitle}" to cart`, 'success');
                    updateCartDisplay();
                    showNotification('Item added to cart!', 'success');
                } else {
                    log(`âœ— Failed to add "${productTitle}": ${data.message}`, 'error');
                    showNotification(data.message, 'error');
                }
            } catch (error) {
                log(`âœ— Error adding to cart: ${error.message}`, 'error');
                showNotification('Error adding to cart', 'error');
            }
        }

        // Update cart display
        async function updateCartDisplay() {
            try {
                const response = await fetch('api/cart.php?action=get');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('header-cart-count').textContent = data.count || 0;
                    log(`Cart count updated: ${data.count || 0}`, 'info');
                } else {
                    document.getElementById('header-cart-count').textContent = '0';
                }
            } catch (error) {
                log(`Error updating cart display: ${error.message}`, 'error');
            }
        }

        // View cart contents
        async function viewCart() {
            try {
                const response = await fetch('api/cart.php?action=get');
                const data = await response.json();
                
                if (data.success) {
                    let cartHTML = `<h3>Cart Contents (${data.count} items)</h3>`;
                    if (data.items && data.items.length > 0) {
                        data.items.forEach(item => {
                            cartHTML += `<div>â€¢ ${item.title} - Qty: ${item.quantity} - $${item.price}</div>`;
                        });
                        cartHTML += `<br><strong>Total: $${data.total}</strong>`;
                    } else {
                        cartHTML += '<div>Cart is empty</div>';
                    }
                    document.getElementById('cart-contents').innerHTML = cartHTML;
                    log('Cart contents displayed', 'success');
                } else {
                    document.getElementById('cart-contents').innerHTML = 
                        '<div class="error">Unable to load cart: ' + data.message + '</div>';
                    log('Failed to load cart: ' + data.message, 'error');
                }
            } catch (error) {
                document.getElementById('cart-contents').innerHTML = 
                    '<div class="error">Error loading cart: ' + error.message + '</div>';
                log('Error loading cart: ' + error.message, 'error');
            }
        }

        // Clear cart
        async function clearCart() {
            if (!confirm('Are you sure you want to clear your cart?')) return;
            
            try {
                const response = await fetch('api/cart.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'action=clear'
                });

                const data = await response.json();
                
                if (data.success) {
                    log('âœ“ Cart cleared successfully', 'success');
                    updateCartDisplay();
                    viewCart();
                    showNotification('Cart cleared!', 'success');
                } else {
                    log('âœ— Failed to clear cart: ' + data.message, 'error');
                    showNotification('Failed to clear cart', 'error');
                }
            } catch (error) {
                log('âœ— Error clearing cart: ' + error.message, 'error');
                showNotification('Error clearing cart', 'error');
            }
        }

        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `status ${type}`;
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '1000';
            notification.style.maxWidth = '300px';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            log('Cart test page loaded', 'info');
            checkSystemStatus();
            checkAuthStatus();
            loadProducts();
        });
    </script>
</body>
</html>
